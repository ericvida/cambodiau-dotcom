{"id":"dn","warnings":[],"errors":[],"js":"function defineName$__(cls,name){\n\tObject.defineProperty(cls,\"name\",{value:name,configurable:true});\n};;\nfunction inheritClass$__(cls){\n\tObject.getPrototypeOf(cls.prototype).constructor?.inherited?.(cls);\n};\nconst $__initor__$ = Symbol.for('#__initor__'), $__inited__$ = Symbol.for('#__inited__'), $__hooks__$ = Symbol.for('#__hooks__'), $idler$ = Symbol.for('#idler'), $resolve$ = Symbol.for('#resolve');\nvar $1 = Symbol();\n\n/*body*/\nimport {emit,listen,once,unlisten} from './utils';\n\nexport class Queue extends Set {\n\t\n\tconstructor(){\n\t\t\n\t\tsuper();\n\t\tthis[$idler$] = Promise.resolve(this);\n\t\tthis[$__initor__$]===$1 && (this[$__hooks__$]&&this[$__hooks__$].inited(this),this[$__inited__$] && this[$__inited__$]());\n\t}\n\t\n\temit(name,...params){\n\t\treturn emit(this,name,params);\n\t}\n\ton(name,...params){\n\t\treturn listen(this,name,...params);\n\t}\n\tonce(name,...params){\n\t\treturn once(this,name,...params);\n\t}\n\tun(name,...params){\n\t\treturn unlisten(this,name,...params);\n\t}\n\t\n\tadd(value){\n\t\tvar self = this;\n\t\t\n\t\tif (value instanceof Function) {\n\t\t\t\n\t\t\tvalue = value();\n\t\t};\n\t\t\n\t\tif (!(this.has(value))) {\n\t\t\t\n\t\t\tvalue.then(function() { return self.delete(value); });\n\t\t\tlet first = this.size == 0;\n\t\t\tsuper.add(value);\n\t\t\tif (first) {\n\t\t\t\t\n\t\t\t\tthis[$idler$] = this[$resolve$] = null;\n\t\t\t\tthis.emit('busy',this);\n\t\t\t};\n\t\t};\n\t\treturn value;\n\t}\n\t\n\tdelete(value){\n\t\t\n\t\tif (super.delete(value)) {\n\t\t\t\n\t\t\tif (this.size == 0) {\n\t\t\t\t\n\t\t\t\tif (this[$resolve$]) {\n\t\t\t\t\t\n\t\t\t\t\tthis[$resolve$](this);\n\t\t\t\t\tthis[$resolve$] = null;\n\t\t\t\t};\n\t\t\t\tthis.emit('idle',this);\n\t\t\t};\n\t\t\treturn true;\n\t\t};\n\t\treturn false;\n\t}\n\t\n\tget idle(){\n\t\tvar self = this;\n\t\t\n\t\treturn this[$idler$] ||= new Promise(function(resolve) {\n\t\t\t\n\t\t\treturn self[$resolve$] = resolve;\n\t\t});\n\t}\n\tstatic {\n\t\tthis.prototype[$__initor__$] = $1;defineName$__(this,'Queue');inheritClass$__(this);}\n};\n\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXVldWUuaW1iYSIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInF1ZXVlLmltYmEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtlbWl0LGxpc3RlbixvbmNlLHVubGlzdGVufSBmcm9tICcuL3V0aWxzJ1xuXG5leHBvcnQgY2xhc3MgUXVldWUgPCBTZXRcblx0Y29uc3RydWN0b3Jcblx0XHRzdXBlcigpXG5cdFx0I2lkbGVyID0gUHJvbWlzZS5yZXNvbHZlKHRoaXMpXG5cdFxuXHRkZWYgZW1pdCBuYW1lLCAuLi5wYXJhbXMgZG8gZW1pdChzZWxmLG5hbWUscGFyYW1zKVxuXHRkZWYgb24gbmFtZSwgLi4ucGFyYW1zIGRvIGxpc3RlbihzZWxmLG5hbWUsLi4ucGFyYW1zKVxuXHRkZWYgb25jZSBuYW1lLCAuLi5wYXJhbXMgZG8gb25jZShzZWxmLG5hbWUsLi4ucGFyYW1zKVxuXHRkZWYgdW4gbmFtZSwgLi4ucGFyYW1zIGRvIHVubGlzdGVuKHNlbGYsbmFtZSwuLi5wYXJhbXMpXG5cblx0ZGVmIGFkZCB2YWx1ZVxuXHRcdGlmIHZhbHVlIGlzYSBGdW5jdGlvblxuXHRcdFx0dmFsdWUgPSB2YWx1ZSgpXG5cblx0XHR1bmxlc3MgaGFzKHZhbHVlKVxuXHRcdFx0dmFsdWUudGhlbiBkbyBzZWxmLmRlbGV0ZSh2YWx1ZSlcblx0XHRcdGxldCBmaXJzdCA9IHNpemUgPT0gMFxuXHRcdFx0c3VwZXIodmFsdWUpXG5cdFx0XHRpZiBmaXJzdFxuXHRcdFx0XHQjaWRsZXIgPSAjcmVzb2x2ZSA9IG51bGxcblx0XHRcdFx0c2VsZi5lbWl0KCdidXN5JyxzZWxmKVxuXHRcdHJldHVybiB2YWx1ZVxuXG5cdGRlZiBkZWxldGUgdmFsdWVcblx0XHRpZiBzdXBlcih2YWx1ZSlcblx0XHRcdGlmIHNpemUgPT0gMFxuXHRcdFx0XHRpZiAjcmVzb2x2ZVxuXHRcdFx0XHRcdCNyZXNvbHZlKHNlbGYpXG5cdFx0XHRcdFx0I3Jlc29sdmUgPSBudWxsXG5cdFx0XHRcdHNlbGYuZW1pdCgnaWRsZScsc2VsZilcblx0XHRcdHJldHVybiB0cnVlXG5cdFx0cmV0dXJuIGZhbHNlXG5cblx0Z2V0IGlkbGVcblx0XHQjaWRsZXIgfHw9IG5ldyBQcm9taXNlIGRvKHJlc29sdmUpXG5cdFx0XHQjcmVzb2x2ZSA9IHJlc29sdmUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBLE1BQU0sRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLE9BQU8sU0FBUzs7QUFFakQsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLFNBQUcsR0FBRyxFQUFBOztDQUN2QixXQUFXLEVBQUE7O0VBQ1YsS0FBSyxFQUFFO2VBQ0QsR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQzs7RUFBQTs7Q0FFM0IsSUFBSSxDQUFDLElBQUksSUFBSyxNQUFNO0VBQUksT0FBQSxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7RUFQbkQ7Q0FRSyxFQUFFLENBQUMsSUFBSSxJQUFLLE1BQU07RUFBSSxPQUFBLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFJLEdBQUEsTUFBTSxDQUFDO0VBUnREO0NBU0ssSUFBSSxDQUFDLElBQUksSUFBSyxNQUFNO0VBQUksT0FBQSxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBSSxHQUFBLE1BQU0sQ0FBQztFQVR0RDtDQVVLLEVBQUUsQ0FBQyxJQUFJLElBQUssTUFBTTtFQUFJLE9BQUEsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUksR0FBQSxNQUFNLENBQUM7RUFWeEQ7O0NBWUssR0FBRyxDQUFDLEtBQUssQ0FBQTs7O0VBQ1osRUFBRSxFQUFDLEtBQUssWUFBSyxRQUFRLEVBQUE7O0dBQ3BCLEtBQUssR0FBRyxLQUFLLEVBQUU7R0FBQTs7RUFFaEIsRUFBTSxJQUFDLEtBQUEsR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFBOztHQUNoQixLQUFLLENBQUMsSUFBSSxDQUFDLFFBQUUsS0FBQyxPQUFBLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUEsQ0FBdEI7R0FDTixJQUFBLEtBQUssR0FBRyxLQUFBLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztHQUNyQixNQVBFLEdBQUcsQ0FPQyxLQUFLLENBQUM7R0FDWixFQUFFLEVBQUMsS0FBSyxFQUFBOztpQkFDRCxrQkFBVyxHQUFHLElBQUk7SUFDeEIsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQUE7R0FBQTtFQUN4QixNQUFNLENBQUMsS0FBSztFQUFBOztDQUVULE1BQU0sQ0FBQyxLQUFLLENBQUE7O0VBQ2YsRUFBRSxFQUFDLE1BREEsTUFBTSxDQUNBLEtBQUssQ0FBQyxFQUFBOztHQUNkLEVBQUUsRUFBQyxLQUFBLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFBOztJQUNYLEVBQUUsaUJBQVMsRUFBQTs7b0JBQ0YsQ0FBQyxJQUFJLENBQUM7b0JBQ04sR0FBRyxJQUFJO0tBQUE7SUFDaEIsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQUE7R0FDdkIsTUFBTSxDQUFDLElBQUk7R0FBQTtFQUNaLE1BQU0sQ0FBQyxLQUFLO0VBQUE7O0NBRWIsR0FBRyxDQUFDLElBQUksRUFBQTs7O3NCQUNELEtBQVMsR0FBRCxDQUFDLE9BQU8sQ0FBQyxRQUFFLENBQUMsT0FBTyxFQUFDOzt5QkFDekIsR0FBRyxPQUFPO0dBQUEsQ0FERztFQUNIOzs7QUFBQSxDQUFBO0FBQUE7In0=","css":""}